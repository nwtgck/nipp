Opal.modules.date=function(Opal){function $rb_plus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs+rhs:lhs["$+"](rhs)}function $rb_minus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs-rhs:lhs["$-"](rhs)}function $rb_lt(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs<rhs:lhs["$<"](rhs)}Opal.top;var $nesting=[],nil=Opal.nil,$klass=(Opal.breaker,Opal.slice,Opal.klass),$send=Opal.send,$truthy=Opal.truthy;return Opal.add_stubs(["$include","$<=>","$nonzero?","$d","$zero?","$new","$class","$-@","$+@","$===","$coerce","$==","$>","$+","$allocate","$join","$compact","$map","$to_proc","$downcase","$wrap","$raise","$clone","$jd","$>>","$wday","$-","$to_s","$alias_method","$to_i","$<","$*","$reverse","$step","$abs","$each"]),function($base,$super,$parent_nesting){function $Date(){}var TMP_Date_initialize_17,TMP_Date_$_18,TMP_Date_$_19,TMP_Date_$lt_20,TMP_Date_$lt$eq_21,TMP_Date_$gt_22,TMP_Date_$gt$eq_23,TMP_Date_$lt$eq$gt_24,TMP_Date_$gt$gt_25,TMP_Date_$lt$lt_26,TMP_Date_clone_27,TMP_Date_day_28,TMP_Date_friday$q_29,TMP_Date_jd_30,TMP_Date_julian$q_31,TMP_Date_monday$q_32,TMP_Date_month_33,TMP_Date_next_34,TMP_Date_next_day_35,TMP_Date_next_month_36,TMP_Date_prev_day_37,TMP_Date_prev_month_38,TMP_Date_saturday$q_39,TMP_Date_strftime_40,TMP_Date_sunday$q_41,TMP_Date_thursday$q_42,TMP_Date_to_s_43,TMP_Date_tuesday$q_44,TMP_Date_step_45,TMP_Date_upto_49,TMP_Date_downto_50,TMP_Date_wday_51,TMP_Date_wednesday$q_52,TMP_Date_year_53,TMP_Date_cwday_54,TMP_Date_cweek_55,self=$Date=$klass($base,null,"Date",$Date),def=self.$$proto,$nesting=[self].concat($parent_nesting);function days_in_month(year,month){return[31,year%4==0&&year%100!=0||year%400==0?29:28,31,30,31,30,31,31,30,31,30,31][month]}def.date=nil,self.$include(Opal.const_get_relative($nesting,"Comparable")),function($base,$super,$parent_nesting){function $Infinity(){}var TMP_Infinity_initialize_1,TMP_Infinity_d_2,TMP_Infinity_zero$q_3,TMP_Infinity_finite$q_4,TMP_Infinity_infinite$q_5,TMP_Infinity_nan$q_6,TMP_Infinity_abs_7,TMP_Infinity_$$_8,TMP_Infinity_$$_9,TMP_Infinity_$lt$eq$gt_10,TMP_Infinity_coerce_11,TMP_Infinity_to_f_12,self=$Infinity=$klass($base,$super,"Infinity",$Infinity),def=self.$$proto,$nesting=[self].concat($parent_nesting);def.d=nil,self.$include(Opal.const_get_relative($nesting,"Comparable")),Opal.defn(self,"$initialize",TMP_Infinity_initialize_1=function(d){return null==d&&(d=1),this.d=d["$<=>"](0)},TMP_Infinity_initialize_1.$$arity=-1),Opal.defn(self,"$d",TMP_Infinity_d_2=function(){return this.d},TMP_Infinity_d_2.$$arity=0),Opal.defn(self,"$zero?",TMP_Infinity_zero$q_3=function(){return!1},TMP_Infinity_zero$q_3.$$arity=0),Opal.defn(self,"$finite?",TMP_Infinity_finite$q_4=function(){return!1},TMP_Infinity_finite$q_4.$$arity=0),Opal.defn(self,"$infinite?",TMP_Infinity_infinite$q_5=function(){return this.$d()["$nonzero?"]()},TMP_Infinity_infinite$q_5.$$arity=0),Opal.defn(self,"$nan?",TMP_Infinity_nan$q_6=function(){return this.$d()["$zero?"]()},TMP_Infinity_nan$q_6.$$arity=0),Opal.defn(self,"$abs",TMP_Infinity_abs_7=function(){return this.$class().$new()},TMP_Infinity_abs_7.$$arity=0),Opal.defn(self,"$-@",TMP_Infinity_$$_8=function(){return this.$class().$new(this.$d()["$-@"]())},TMP_Infinity_$$_8.$$arity=0),Opal.defn(self,"$+@",TMP_Infinity_$$_9=function(){return this.$class().$new(this.$d()["$+@"]())},TMP_Infinity_$$_9.$$arity=0),Opal.defn(self,"$<=>",TMP_Infinity_$lt$eq$gt_10=function(other){var $a,$b,$case,l=nil,r=nil;if($case=other,Opal.const_get_relative($nesting,"Infinity")["$==="]($case))return this.$d()["$<=>"](other.$d());if(Opal.const_get_relative($nesting,"Numeric")["$==="]($case))return this.$d();try{return $b=other.$coerce(this),l=null==($a=Opal.to_ary($b))[0]?nil:$a[0],r=null==$a[1]?nil:$a[1],l["$<=>"](r)}catch($err){if(!Opal.rescue($err,[Opal.const_get_relative($nesting,"NoMethodError")]))throw $err;Opal.pop_exception()}return nil},TMP_Infinity_$lt$eq$gt_10.$$arity=1),Opal.defn(self,"$coerce",TMP_Infinity_coerce_11=function(other){var $zuper_ii,self=this,$iter=TMP_Infinity_coerce_11.$$p,$case=nil,$zuper=nil,$zuper_i=nil;for($iter&&(TMP_Infinity_coerce_11.$$p=null),$zuper_i=0,$zuper_ii=arguments.length,$zuper=new Array($zuper_ii);$zuper_i<$zuper_ii;$zuper_i++)$zuper[$zuper_i]=arguments[$zuper_i];return $case=other,Opal.const_get_relative($nesting,"Numeric")["$==="]($case)?[self.$d()["$-@"](),self.$d()]:$send(self,Opal.find_super_dispatcher(self,"coerce",TMP_Infinity_coerce_11,!1),$zuper,$iter)},TMP_Infinity_coerce_11.$$arity=1),Opal.defn(self,"$to_f",TMP_Infinity_to_f_12=function(){var lhs,rhs;return this.d["$=="](0)?0:$truthy((lhs=this.d,rhs=0,"number"==typeof lhs&&"number"==typeof rhs?rhs<lhs:lhs["$>"](rhs)))?Opal.const_get_qualified(Opal.const_get_relative($nesting,"Float"),"INFINITY"):Opal.const_get_qualified(Opal.const_get_relative($nesting,"Float"),"INFINITY")["$-@"]()},TMP_Infinity_to_f_12.$$arity=0)}($nesting[0],Opal.const_get_relative($nesting,"Numeric"),$nesting),Opal.const_set($nesting[0],"JULIAN",Opal.const_get_relative($nesting,"Infinity").$new()),Opal.const_set($nesting[0],"GREGORIAN",Opal.const_get_relative($nesting,"Infinity").$new()["$-@"]()),Opal.const_set($nesting[0],"ITALY",2299161),Opal.const_set($nesting[0],"ENGLAND",2361222),Opal.const_set($nesting[0],"MONTHNAMES",$rb_plus([nil],["January","February","March","April","May","June","July","August","September","October","November","December"])),Opal.const_set($nesting[0],"ABBR_MONTHNAMES",["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"]),Opal.const_set($nesting[0],"DAYNAMES",["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]),Opal.const_set($nesting[0],"ABBR_DAYNAMES",["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]),function(self,$parent_nesting){self.$$proto;var TMP_wrap_13,TMP_parse_14,TMP_today_15,TMP_gregorian_leap$q_16,$nesting=[self].concat($parent_nesting);Opal.alias(self,"civil","new"),Opal.defn(self,"$wrap",TMP_wrap_13=function(native$){var instance=nil;return(instance=this.$allocate()).date=native$,instance},TMP_wrap_13.$$arity=1),Opal.defn(self,"$parse",TMP_parse_14=function(string,comp){null==comp&&(comp=!0);var current_date=new Date,current_day=current_date.getDate(),current_month=current_date.getMonth(),current_year=current_date.getFullYear(),current_wday=current_date.getDay(),full_month_name_regexp=Opal.const_get_relative($nesting,"MONTHNAMES").$compact().$join("|");function match1(match){return match[1]}function match2(match){return match[2]}function match3(match){return match[3]}function match4(match){return match[4]}function fromShortYear(fn){return function(match){var short_year=fn(match);return short_year+=69<=short_year?1900:2e3}}function fromMonthAbbr(fn){return function(match){var abbr=fn(match).toLowerCase();return Opal.const_get_relative($nesting,"ABBR_MONTHNAMES").indexOf(abbr)+1}}function toInt(fn){return function(match){var value=fn(match);return parseInt(value,10)}}function fromFullMonthName(fn){return function(match){var month_name=fn(match);return $send(Opal.const_get_relative($nesting,"MONTHNAMES").$compact(),"map",[],"downcase".$to_proc()).indexOf(month_name.$downcase())+1}}var fn,rule,i,match,rules=[{regexp:/^(\d{2})$/,year:current_year,month:current_month,day:toInt(match1)},{regexp:/^(\d{3})$/,year:current_year,month:0,day:toInt(match1)},{regexp:/^(\d{2})(\d{2})$/,year:current_year,month:toInt(match1),day:toInt(match2)},{regexp:/^(\d{2})(\d{3})$/,year:fromShortYear(toInt(match1)),month:0,day:toInt(match2)},{regexp:/^(\d{2})(\d{2})(\d{2})$/,year:fromShortYear(toInt(match1)),month:toInt(match2),day:toInt(match3)},{regexp:/^(\d{4})(\d{3})$/,year:toInt(match1),month:0,day:toInt(match2)},{regexp:/^(\d{4})(\d{2})(\d{2})$/,year:toInt(match1),month:toInt(match2),day:toInt(match3)},{regexp:/^([a-z]{3})[\s\.\/\-](\d{3,4})$/,year:toInt(match2),month:fromMonthAbbr(match1),day:1},{regexp:/^(\d{1,2})[\s\.\/\-]([a-z]{3})[\s\.\/\-](\d{3,4})$/i,year:toInt(match3),month:fromMonthAbbr(match2),day:toInt(match1)},{regexp:/^([a-z]{3})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{3,4})$/i,year:toInt(match3),month:fromMonthAbbr(match1),day:toInt(match2)},{regexp:/^(\d{3,4})[\s\.\/\-]([a-z]{3})[\s\.\/\-](\d{1,2})$/i,year:toInt(match1),month:fromMonthAbbr(match2),day:toInt(match3)},{regexp:/^(\-?\d{3,4})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{1,2})$/,year:toInt(match1),month:toInt(match2),day:toInt(match3)},{regexp:/^(\d{2})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{1,2})$/,year:(fn=toInt(match1),function(match){var value=fn(match);return comp?value+2e3:value}),month:toInt(match2),day:toInt(match3)},{regexp:/^(\d{1,2})[\s\.\/\-](\d{1,2})[\s\.\/\-](\-?\d{3,4})$/,year:toInt(match3),month:toInt(match2),day:toInt(match1)},{regexp:new RegExp("^("+Opal.const_get_relative($nesting,"DAYNAMES").$join("|")+")$","i"),year:current_year,month:current_month,day:function(fn){return function(match){var dayname=fn(match),wday=$send(Opal.const_get_relative($nesting,"DAYNAMES"),"map",[],"downcase".$to_proc()).indexOf(dayname.$downcase());return current_day-current_wday+wday}}(match1)},{regexp:new RegExp("^("+full_month_name_regexp+")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)[\\s\\.\\/\\-](\\-?\\d{3,4})$","i"),year:toInt(match4),month:fromFullMonthName(match1),day:toInt(match2)},{regexp:new RegExp("^("+full_month_name_regexp+")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)","i"),year:current_year,month:fromFullMonthName(match1),day:toInt(match2)},{regexp:new RegExp("^(\\d{1,2})(th|nd|rd)[\\s\\.\\/\\-]("+full_month_name_regexp+")[\\s\\.\\/\\-](\\-?\\d{3,4})$","i"),year:toInt(match4),month:fromFullMonthName(match3),day:toInt(match1)},{regexp:new RegExp("^(\\-?\\d{3,4})[\\s\\.\\/\\-]("+full_month_name_regexp+")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)$","i"),year:toInt(match1),month:fromFullMonthName(match2),day:toInt(match3)}];for(i=0;i<rules.length;i++)if(match=(rule=rules[i]).regexp.exec(string)){var year=rule.year;"function"==typeof year&&(year=year(match));var month=rule.month;"function"==typeof month&&(month=month(match)-1);var day=rule.day;"function"==typeof day&&(day=day(match));var result=new Date(year,month,day);return 0<=year&&year<=1970&&result.setFullYear(year),this.$wrap(result)}return this.$raise(Opal.const_get_relative($nesting,"ArgumentError"),"invalid date")},TMP_parse_14.$$arity=-2),Opal.defn(self,"$today",TMP_today_15=function(){return this.$wrap(new Date)},TMP_today_15.$$arity=0),Opal.defn(self,"$gregorian_leap?",TMP_gregorian_leap$q_16=function(year){return new Date(year,1,29).getMonth()-1==0},TMP_gregorian_leap$q_16.$$arity=1)}(Opal.get_singleton_class(self),$nesting),Opal.defn(self,"$initialize",TMP_Date_initialize_17=function(year,month,day,start){return null==year&&(year=-4712),null==month&&(month=1),null==day&&(day=1),null==start&&(start=Opal.const_get_relative($nesting,"ITALY")),this.date=new Date(year,month-1,day)},TMP_Date_initialize_17.$$arity=-1),Opal.defn(self,"$-",TMP_Date_$_18=function(date){if(date.$$is_number){var result=this.$clone();return result.date.setDate(this.date.getDate()-date),result}if(date.date)return Math.round((this.date-date.date)/864e5);this.$raise(Opal.const_get_relative($nesting,"TypeError"))},TMP_Date_$_18.$$arity=1),Opal.defn(self,"$+",TMP_Date_$_19=function(date){if(date.$$is_number){var result=this.$clone();return result.date.setDate(this.date.getDate()+date),result}this.$raise(Opal.const_get_relative($nesting,"TypeError"))},TMP_Date_$_19.$$arity=1),Opal.defn(self,"$<",TMP_Date_$lt_20=function(other){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),a<b},TMP_Date_$lt_20.$$arity=1),Opal.defn(self,"$<=",TMP_Date_$lt$eq_21=function(other){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),a<=b},TMP_Date_$lt$eq_21.$$arity=1),Opal.defn(self,"$>",TMP_Date_$gt_22=function(other){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),b<a},TMP_Date_$gt_22.$$arity=1),Opal.defn(self,"$>=",TMP_Date_$gt$eq_23=function(other){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),b<=a},TMP_Date_$gt$eq_23.$$arity=1),Opal.defn(self,"$<=>",TMP_Date_$lt$eq$gt_24=function(other){if(other.$$is_number)return this.$jd()["$<=>"](other);if(Opal.const_get_relative($nesting,"Date")["$==="](other)){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),a<b?-1:b<a?1:0}return nil},TMP_Date_$lt$eq$gt_24.$$arity=1),Opal.defn(self,"$>>",TMP_Date_$gt$gt_25=function(n){n.$$is_number||this.$raise(Opal.const_get_relative($nesting,"TypeError"));var result=this.$clone(),date=result.date,cur=date.getDate();return date.setDate(1),date.setMonth(date.getMonth()+n),date.setDate(Math.min(cur,days_in_month(date.getFullYear(),date.getMonth()))),result},TMP_Date_$gt$gt_25.$$arity=1),Opal.defn(self,"$<<",TMP_Date_$lt$lt_26=function(n){return n.$$is_number||this.$raise(Opal.const_get_relative($nesting,"TypeError")),this["$>>"](-n)},TMP_Date_$lt$lt_26.$$arity=1),Opal.alias(self,"eql?","=="),Opal.defn(self,"$clone",TMP_Date_clone_27=function(){return Opal.const_get_relative($nesting,"Date").$wrap(new Date(this.date.getTime()))},TMP_Date_clone_27.$$arity=0),Opal.defn(self,"$day",TMP_Date_day_28=function(){return this.date.getDate()},TMP_Date_day_28.$$arity=0),Opal.defn(self,"$friday?",TMP_Date_friday$q_29=function(){return this.$wday()["$=="](5)},TMP_Date_friday$q_29.$$arity=0),Opal.defn(self,"$jd",TMP_Date_jd_30=function(){var ggg,s,a,j1,jd,mm=this.date.getMonth()+1,dd=this.date.getDate(),yy=this.date.getFullYear(),hr=12;return hr=hr+0+0,ggg=1,yy<=1585&&(ggg=0),jd=-1*Math.floor(7*(Math.floor((mm+9)/12)+yy)/4),s=1,mm-9<0&&(s=-1),a=Math.abs(mm-9),j1=Math.floor(yy+s*Math.floor(a/7)),j1=-1*Math.floor(3*(Math.floor(j1/100)+1)/4),jd=(jd=jd+Math.floor(275*mm/9)+dd+ggg*j1)+1721027+2*ggg+367*yy-.5,jd+=hr/24},TMP_Date_jd_30.$$arity=0),Opal.defn(self,"$julian?",TMP_Date_julian$q_31=function(){return this.date<new Date(1582,9,15,12)},TMP_Date_julian$q_31.$$arity=0),Opal.defn(self,"$monday?",TMP_Date_monday$q_32=function(){return this.$wday()["$=="](1)},TMP_Date_monday$q_32.$$arity=0),Opal.defn(self,"$month",TMP_Date_month_33=function(){return this.date.getMonth()+1},TMP_Date_month_33.$$arity=0),Opal.defn(self,"$next",TMP_Date_next_34=function(){return $rb_plus(this,1)},TMP_Date_next_34.$$arity=0),Opal.defn(self,"$next_day",TMP_Date_next_day_35=function(n){return null==n&&(n=1),$rb_plus(this,n)},TMP_Date_next_day_35.$$arity=-1),Opal.defn(self,"$next_month",TMP_Date_next_month_36=function(){var result=this.$clone(),date=result.date,cur=date.getDate();return date.setDate(1),date.setMonth(date.getMonth()+1),date.setDate(Math.min(cur,days_in_month(date.getFullYear(),date.getMonth()))),result},TMP_Date_next_month_36.$$arity=0),Opal.defn(self,"$prev_day",TMP_Date_prev_day_37=function(n){return null==n&&(n=1),$rb_minus(this,n)},TMP_Date_prev_day_37.$$arity=-1),Opal.defn(self,"$prev_month",TMP_Date_prev_month_38=function(){var result=this.$clone(),date=result.date,cur=date.getDate();return date.setDate(1),date.setMonth(date.getMonth()-1),date.setDate(Math.min(cur,days_in_month(date.getFullYear(),date.getMonth()))),result},TMP_Date_prev_month_38.$$arity=0),Opal.defn(self,"$saturday?",TMP_Date_saturday$q_39=function(){return this.$wday()["$=="](6)},TMP_Date_saturday$q_39.$$arity=0),Opal.defn(self,"$strftime",TMP_Date_strftime_40=function(format){return null==format&&(format=""),""==format?this.$to_s():this.date.$strftime(format)},TMP_Date_strftime_40.$$arity=-1),self.$alias_method("succ","next"),Opal.defn(self,"$sunday?",TMP_Date_sunday$q_41=function(){return this.$wday()["$=="](0)},TMP_Date_sunday$q_41.$$arity=0),Opal.defn(self,"$thursday?",TMP_Date_thursday$q_42=function(){return this.$wday()["$=="](4)},TMP_Date_thursday$q_42.$$arity=0),Opal.defn(self,"$to_s",TMP_Date_to_s_43=function(){var d=this.date,year=d.getFullYear(),month=d.getMonth()+1,day=d.getDate();return month<10&&(month="0"+month),day<10&&(day="0"+day),year+"-"+month+"-"+day},TMP_Date_to_s_43.$$arity=0),Opal.defn(self,"$tuesday?",TMP_Date_tuesday$q_44=function(){return this.$wday()["$=="](2)},TMP_Date_tuesday$q_44.$$arity=0),Opal.defn(self,"$step",TMP_Date_step_45=function(limit,step){var TMP_46,TMP_47,TMP_48,result,lhs,rhs,$iter=TMP_Date_step_45.$$p,block=$iter||nil,steps_count=nil,steps=nil;return null==step&&(step=1),$iter&&(TMP_Date_step_45.$$p=null),steps_count=$rb_minus(limit,this).$to_i(),steps=$truthy($rb_lt((rhs=step,"number"==typeof(lhs=steps_count)&&"number"==typeof rhs?lhs*rhs:lhs["$*"](rhs)),0))?[]:$truthy($rb_lt(steps_count,0))?$send(Opal.Range.$new(0,steps_count["$-@"](),!1).$step(step.$abs()),"map",[],(TMP_46=function(i){TMP_46.$$s;return null==i&&(i=nil),i["$-@"]()},TMP_46.$$s=this,TMP_46.$$arity=1,TMP_46)).$reverse():Opal.Range.$new(0,steps_count,!1).$step(step.$abs()),result=$send(steps,"map",[],((TMP_47=function(i){var self=TMP_47.$$s||this;return null==i&&(i=nil),$rb_plus(self,i)}).$$s=this,TMP_47.$$arity=1,TMP_47)),block!==nil?($send(result,"each",[],((TMP_48=function(i){TMP_48.$$s;return null==i&&(i=nil),Opal.yield1(block,i)}).$$s=this,TMP_48.$$arity=1,TMP_48)),this):result},TMP_Date_step_45.$$arity=-2),Opal.defn(self,"$upto",TMP_Date_upto_49=function(max){var $iter=TMP_Date_upto_49.$$p,block=$iter||nil;return $iter&&(TMP_Date_upto_49.$$p=null),$send(this,"step",[max,1],block.$to_proc())},TMP_Date_upto_49.$$arity=1),Opal.defn(self,"$downto",TMP_Date_downto_50=function(min){var $iter=TMP_Date_downto_50.$$p,block=$iter||nil;return $iter&&(TMP_Date_downto_50.$$p=null),$send(this,"step",[min,-1],block.$to_proc())},TMP_Date_downto_50.$$arity=1),Opal.defn(self,"$wday",TMP_Date_wday_51=function(){return this.date.getDay()},TMP_Date_wday_51.$$arity=0),Opal.defn(self,"$wednesday?",TMP_Date_wednesday$q_52=function(){return this.$wday()["$=="](3)},TMP_Date_wednesday$q_52.$$arity=0),Opal.defn(self,"$year",TMP_Date_year_53=function(){return this.date.getFullYear()},TMP_Date_year_53.$$arity=0),Opal.defn(self,"$cwday",TMP_Date_cwday_54=function(){return this.date.getDay()||7},TMP_Date_cwday_54.$$arity=0),Opal.defn(self,"$cweek",TMP_Date_cweek_55=function(){var d=new Date(this.date);return d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7)),Math.ceil(((d-new Date(d.getFullYear(),0,1))/864e5+1)/7)},TMP_Date_cweek_55.$$arity=0)}($nesting[0],0,$nesting)};
